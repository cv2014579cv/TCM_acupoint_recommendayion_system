# 中醫經穴智慧推薦系統 (TCM Acupoint Recommender)

本專案是一個結合中醫經絡辨證論治算法與視覺化圖表的經穴推薦系統。系統核心採用 Python 實作推薦邏輯，並透過 FastAPI 提供後端接口，最終在現代化的 Web 介面中呈現。

## 1. 系統架構 (System Architecture)

本系統採前後端分離架構：

*   **核心算法層 (Algorithm Core)**: `tcm_recommender.py`
    *   負責處理所有複雜的辨證邏輯、經脈排名、五行排序及交會穴篩選。
*   **後端 API 層 (Backend API)**: `backend/main.py`
    *   基於 FastAPI 框架，將算法核心封裝為 RESTful API。
    *   提供 `/recommend` (推薦核心) 與 `/symptoms` (獲取症狀列表) 接口。
*   **前端展示層 (Frontend UI)**: `web/` 資料夾
    *   `index.html`: 提供響應式且美觀的系統介面。
    *   `style.css`: 採用現代深色調與金色設計 (Glassmorphism)，並針對桌面進行優化。
    *   `script.js`: 處理使用者的點擊座標、症狀過濾及與後端 API 的非同步通訊。

---

## 2. 核心算法流程 (Core Recommendation Logic)

系統遵循「雙路徑輸入、全域聯集排序」的準則：

### **路徑 A：症狀辨證 (Path A)**
1.  使用者輸入症狀。
2.  系統從 `match_table.csv` 比對符合的穴位。
3.  **篩選機制**：穴位必須屬於「五腧穴/原穴/俞穴」，且該穴位必須至少匹配 2 個輸入症狀（Importance A）。
4.  產出 **A1 (直屬經脈推薦)** 與 **A2 (表裡經脈/交會穴推薦)**。

### **路徑 B：視覺觸診 (Path B)**
1.  使用者在經脈分布圖上點擊位置 (X, Y)。
2.  系統計算該座標周邊 25（或 10）單位像素內的穴位。
3.  產出 **B1 (局部直屬經脈)** 與 **B2 (局部表裡經脈)**。

### **全域聯集排序 (Global Ranking)**
*   系統將 A1 與 B1 的所有候選經脈進行累加計數。
*   **優先序規則**：匹配症狀/點擊數越多 > 符合 Path A 五行序列 > 傳統經脈順序。
*   最終將穴位按經脈權重、類別、五行順位進行交錯排列，確保推薦結果既具備學術精準性，又便於临床選穴。

---

## 3. 前端交互功能 (Frontend Features)

*   **智慧下拉選單**：在「症狀輸入」框點擊時，會自動彈出資料庫中所有可用症狀，支援關鍵字過濾。
*   **三維度地圖切換**：提供「正面、背面、側面」三張高解析度地圖，方便精準定位。
*   **動態結果呈現**：結果區塊獨立位於右側，會根據計算結果自動展開，並將「直屬經脈」與「表裡經脈」分頁顯示。

---

## 4. 如何啟動系統 (Usage Guide)

### **步驟一：啟動後端**
在專案根目錄執行啟動腳本：
```powershell
python run.py
```
系統會啟動於 `http://localhost:8000`。

### **步驟二：開啟網頁**
使用瀏覽器直接打開 `web/index.html`。

### **步驟三：進行推薦**
1.  在左側上方輸入或選取 2 個以上症狀。
2.  在左側地圖上點擊不適部位。
3.  點擊下方的 **[開始推薦]**。
4.  在右側查看推薦的穴位列表。

---

## 5. 檔案清單說明

*   `tcm_recommender.py`: 算法核心程式碼（論文邏輯實作點）。
*   `backend/main.py`: FastAPI 路由定義。
*   `run.py`: 一鍵啟動後端的便利腳本。
*   `image/`: 存放經脈背景圖 (`front.png`, `back.png`, `side.png`)。
*   `input_csv/`: 所有原始資料庫檔案（包含 match_table, meridian_table 等）。
*   `web/`: 前端所有靜態資源，可獨立佈署於任何 Web 伺服器。
